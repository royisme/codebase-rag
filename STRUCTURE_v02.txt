codebase-rag v0.2 File Structure
=================================

Project Root
├── backend/                          # v0.2 Implementation
│   ├── __init__.py
│   └── app/
│       ├── __init__.py
│       ├── main.py                   # FastAPI application entry point
│       ├── config.py                 # Configuration wrapper
│       ├── dependencies.py           # FastAPI dependency injection
│       │
│       ├── models/                   # Pydantic request/response models
│       │   ├── __init__.py
│       │   ├── ingest_models.py     # IngestRepoRequest, IngestRepoResponse
│       │   ├── graph_models.py      # NodeSummary, RelatedResponse
│       │   └── context_models.py    # ContextItem, ContextPack
│       │
│       ├── routers/                  # API endpoint handlers
│       │   ├── __init__.py
│       │   ├── ingest.py            # POST /api/v1/ingest/repo
│       │   ├── graph.py             # GET /api/v1/graph/related
│       │   └── context.py           # GET /api/v1/context/pack
│       │
│       └── services/                 # Business logic layer
│           ├── __init__.py
│           │
│           ├── graph/               # Neo4j graph database services
│           │   ├── __init__.py
│           │   ├── neo4j_service.py # Neo4j connection, queries
│           │   └── schema.cypher    # Database schema (constraints, indexes)
│           │
│           ├── ingest/              # Repository ingestion services
│           │   ├── __init__.py
│           │   ├── code_ingestor.py # File scanning, language detection
│           │   └── git_utils.py     # Git clone, repo ID generation
│           │
│           ├── ranking/             # Search result ranking
│           │   ├── __init__.py
│           │   └── ranker.py        # Keyword matching, scoring, summaries
│           │
│           └── context/             # Context pack building
│               ├── __init__.py
│               └── pack_builder.py  # Budget-aware context assembly
│
├── scripts/                          # Utility scripts
│   ├── neo4j_bootstrap.sh           # Initialize Neo4j schema
│   └── demo_curl.sh                 # API demonstration with curl
│
├── examples/                         # Usage examples
│   ├── api_client_v02.py            # Python client library
│   ├── hybrid_http_sse_client.py    # (existing)
│   └── pure_mcp_client.py           # (existing)
│
├── Dockerfile.v02                    # Docker image build
├── docker-compose.v02.yml           # Docker Compose orchestration
├── start_v02.py                     # Server startup script
├── test_v02_structure.py            # Structure validation tests
│
├── Documentation
│   ├── README_v02.md                # Complete API documentation
│   ├── QUICKSTART_v02.md            # 5-minute quick start guide
│   └── IMPLEMENTATION_v02.md        # Implementation summary
│
├── Configuration
│   ├── pyproject.toml               # Python package config (updated)
│   ├── .gitignore                   # Git ignore patterns (updated)
│   └── env.example                  # Environment variables template
│
└── Existing Files (unchanged)
    ├── main.py                      # Original application
    ├── config.py                    # Shared configuration
    ├── start.py                     # Original startup
    ├── api/                         # Original API routes
    ├── core/                        # Original core modules
    ├── services/                    # Original services
    └── monitoring/                  # Task monitoring

Key Concepts
============

ref:// Handle Format
--------------------
ref://file/<relative-path>#L<start>-L<end>

Examples:
- ref://file/src/auth/token.py#L1-L200
- ref://file/services/auth.ts#L1-L300

Purpose:
- Compact code references for MCP integration
- On-demand code fetching
- Keeps LLM prompts small

Neo4j Schema
------------
Nodes:
- Repo {id}
- File {repoId, path, lang, size, content, sha}

Relationships:
- (File)-[:IN_REPO]->(Repo)

Indexes:
- Fulltext: File.path, File.lang, File.content
- Unique: Repo.id
- Node Key: File.(repoId, path)

API Endpoints
-------------
1. POST /api/v1/ingest/repo
   - Ingest repository into knowledge graph
   - Returns task_id, status, files_processed

2. GET /api/v1/graph/related
   - Search for related files
   - Returns nodes with ref:// handles

3. GET /api/v1/context/pack
   - Build context within token budget
   - Returns items with summaries and refs

Statistics
==========
Files Created: 29
Lines of Code: ~1,700
Total Size: ~50KB

Breakdown:
- Models: 3 files
- Routers: 3 files  
- Services: 5 files
- Scripts: 2 files
- Documentation: 3 files
- Examples: 1 file
- Deployment: 2 files

Usage
=====
Quick Start:
  docker-compose -f docker-compose.v02.yml up -d
  curl http://localhost:8123/api/v1/health

Manual Start:
  pip install -e .
  ./scripts/neo4j_bootstrap.sh
  python start_v02.py

API Docs:
  http://localhost:8123/docs
